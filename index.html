<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Shanove Music</title>
    
    <!-- ICONS & PWA -->
    <link rel="icon" href="https://n.uguu.se/olrRLQVZ.jpg" type="image/jpeg">
    <link rel="apple-touch-icon" href="https://n.uguu.se/olrRLQVZ.jpg">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#000000">

    <!-- LIBRARIES -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;700&display=swap');
        body { font-family: 'Outfit', sans-serif; background: #000; color: white; overflow: hidden; overscroll-behavior-y: none; }
        ::-webkit-scrollbar { width: 0px; }
        .fs-overlay { transform: translateY(100%); transition: transform 0.4s cubic-bezier(0.33, 1, 0.68, 1); }
        .fs-overlay.active { transform: translateY(0); }
        
        /* Loading Animation */
        .bars { display: flex; justify-content: center; align-items: flex-end; height: 20px; gap: 3px; }
        .bar { width: 4px; background-color: #a855f7; animation: bounce 1s infinite ease-in-out; }
        .bar:nth-child(2) { animation-delay: 0.1s; } .bar:nth-child(3) { animation-delay: 0.2s; } .bar:nth-child(4) { animation-delay: 0.3s; }
        @keyframes bounce { 0%, 100% { height: 5px; } 50% { height: 20px; } }

        /* Range Slider */
        input[type=range] { -webkit-appearance: none; background: transparent; }
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; height: 12px; width: 12px; border-radius: 50%; background: #fff; margin-top: -4px; }
        input[type=range]::-webkit-slider-runnable-track { height: 4px; background: #333; border-radius: 2px; }
    </style>
</head>
<body class="h-screen flex flex-col selection:bg-purple-500 selection:text-white">

    <!-- LOGIN AREA -->
    <div id="loginOverlay" class="fixed inset-0 z-[100] bg-black flex items-center justify-center p-4 bg-[url('https://images.unsplash.com/photo-1614149162883-504ce4d13909?q=80&w=2000&auto=format&fit=crop')] bg-cover bg-center">
        <div class="absolute inset-0 bg-black/90 backdrop-blur-sm"></div>
        <div class="bg-[#121212] border border-[#333] p-8 rounded-2xl w-full max-w-md text-center shadow-2xl relative z-10">
            <div class="mb-8 flex flex-col items-center justify-center">
                <img src="https://n.uguu.se/olrRLQVZ.jpg" class="w-24 h-24 rounded-full mb-4 shadow-lg border-2 border-purple-500/30 object-cover">
                <h1 class="text-3xl font-bold">Shanove Music</h1>
                <p class="text-gray-400 text-sm mt-1">Ferdev Engine V1</p>
            </div>
            
            <div id="emailForm" class="relative z-10 text-left">
                <input type="email" id="emailInput" placeholder="Email kamu..." class="w-full bg-[#1e1e1e] text-white p-4 rounded-xl mb-4 outline-none border border-[#333] focus:border-purple-500 transition text-center">
                <button onclick="sendOTP()" id="btnSend" class="w-full bg-white hover:bg-gray-200 text-black font-bold py-4 rounded-xl transition shadow-lg">Masuk</button>
            </div>

            <div id="otpForm" class="hidden relative z-10 text-left">
                <p class="text-center text-gray-400 mb-2 text-sm">Kode dikirim ke <b id="targetEmail" class="text-white"></b></p>
                <input type="number" id="otpInput" placeholder="000000" class="w-full bg-[#1e1e1e] text-white p-4 rounded-xl mb-4 outline-none text-center tracking-[0.5em] text-xl font-bold border border-[#333] focus:border-purple-500 transition">
                <button onclick="verifyOTP()" class="w-full bg-purple-600 hover:bg-purple-500 text-white font-bold py-4 rounded-xl mb-4 transition shadow-lg">Verifikasi</button>
                <div class="text-center"><button onclick="resetLogin()" class="text-xs text-gray-500 hover:text-white underline">Ubah Email</button></div>
            </div>
            <div id="statusMsg" class="mt-4 text-xs font-mono text-center text-red-400 hidden"></div>
        </div>
    </div>

    <!-- MAIN UI -->
    <div class="flex-1 flex overflow-hidden bg-black">
        <!-- SIDEBAR -->
        <div class="w-64 bg-black hidden md:flex flex-col gap-2 p-2 border-r border-[#1a1a1a]">
            <div class="p-6">
                <div class="flex items-center gap-3 text-white mb-8">
                    <img src="https://n.uguu.se/olrRLQVZ.jpg" class="w-8 h-8 rounded-full border border-white/10">
                    <span class="font-bold text-lg">Shanove</span>
                </div>
                <div class="space-y-1">
                    <div onclick="showHome()" class="flex items-center gap-4 text-white bg-[#1a1a1a] px-4 py-3 rounded-md cursor-pointer hover:bg-[#222]"><i class="fas fa-home w-5"></i> Home</div>
                    <div class="flex items-center gap-4 text-gray-400 hover:text-white px-4 py-3 rounded-md cursor-pointer"><i class="fas fa-search w-5"></i> Search</div>
                </div>
            </div>
            <div class="px-6 flex-1">
                <p class="text-xs font-bold text-gray-500 mb-4 tracking-widest">SUGGESTED</p>
                <div class="space-y-3 text-sm text-gray-400">
                    <div class="cursor-pointer hover:text-white" onclick="searchMusic('Phonk')">ðŸ”¥ Phonk</div>
                    <div class="cursor-pointer hover:text-white" onclick="searchMusic('Galau Indonesia')">ðŸ˜¢ Galau Indo</div>
                    <div class="cursor-pointer hover:text-white" onclick="searchMusic('Nadhif Basalamah')">ðŸŽ¸ Nadhif B.</div>
                    <div class="cursor-pointer hover:text-white" onclick="searchMusic('Tulus')">ðŸŽ¤ Tulus</div>
                </div>
            </div>
        </div>

        <!-- CONTENT -->
        <div class="flex-1 bg-[#0a0a0a] overflow-y-auto relative w-full" id="mainContainer">
            <div class="sticky top-0 p-4 bg-[#0a0a0a]/90 backdrop-blur-xl z-40 flex items-center justify-between border-b border-[#222]">
                <div class="flex items-center gap-4 w-full max-w-lg">
                    <img src="https://n.uguu.se/olrRLQVZ.jpg" class="w-8 h-8 rounded-full md:hidden">
                    <div class="relative w-full">
                        <i class="fas fa-search absolute left-4 top-3.5 text-gray-500"></i>
                        <input type="text" id="searchInput" placeholder="Cari lagu / artis..." class="w-full bg-[#1f1f1f] text-white pl-12 pr-4 py-3 rounded-full outline-none focus:bg-[#2a2a2a] text-sm border border-transparent focus:border-[#333]" onkeypress="if(event.key === 'Enter') searchMusic(this.value)">
                    </div>
                </div>
                <button onclick="logout()" class="hidden md:block text-xs font-bold text-gray-400 border border-gray-700 px-4 py-2 rounded-full hover:text-white">LOGOUT</button>
            </div>

            <div class="p-4 pb-36 min-h-screen">
                <!-- HOME -->
                <div id="homeSuggestions" class="animate-fade-in">
                    <div class="bg-gradient-to-r from-purple-900 to-blue-900 rounded-2xl p-8 mb-8 relative overflow-hidden border border-white/10">
                        <div class="relative z-10">
                            <h1 class="text-3xl font-bold mb-3">Shanove Music Premium</h1>
                            <p class="text-gray-200 mb-6">Engine baru. Audio Full. Tanpa Batas.</p>
                            <button onclick="searchMusic('Top Hits Indonesia')" class="bg-white text-black px-8 py-3 rounded-full font-bold hover:scale-105 transition">Putar Hits</button>
                        </div>
                        <i class="fas fa-compact-disc absolute -right-10 -bottom-10 text-[10rem] text-white/10 rotate-12"></i>
                    </div>
                </div>

                <!-- LOADING INDICATOR -->
                <div id="loading" class="hidden flex flex-col items-center justify-center py-20">
                    <div class="bars mb-4">
                        <div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div>
                    </div>
                    <p class="text-gray-400 text-sm animate-pulse">Menghubungi Server Ferdev...</p>
                </div>
                
                <!-- AUDIO PROCESS INDICATOR -->
                <div id="audioLoader" class="fixed top-24 left-1/2 -translate-x-1/2 bg-[#1f1f1f] border border-purple-500/50 text-white px-6 py-3 rounded-full shadow-2xl z-50 hidden flex items-center gap-3">
                    <i class="fas fa-circle-notch fa-spin text-purple-500"></i>
                    <span class="text-xs font-bold">Downloading Audio (Ferdev)...</span>
                </div>

                <!-- RESULT TITLE -->
                <h2 id="resultTitle" class="text-xl font-bold mb-6 hidden">Hasil Pencarian</h2>

                <!-- GRID -->
                <div id="trackGrid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4 hidden">
                    <!-- Javascript will inject here -->
                </div>
            </div>
        </div>
    </div>

    <!-- PLAYER BAR -->
    <div id="playerBar" class="fixed bottom-0 w-full h-[90px] bg-black border-t border-[#222] px-4 flex items-center justify-between z-50">
        <div class="flex items-center w-[30%] gap-3 cursor-pointer group" onclick="openFullscreen()">
            <img id="miniThumb" src="https://n.uguu.se/olrRLQVZ.jpg" class="w-14 h-14 rounded object-cover shadow-lg border border-white/10">
            <div class="overflow-hidden">
                <h4 id="miniTitle" class="text-sm font-bold text-white truncate">Shanove Music</h4>
                <p id="miniArtist" class="text-xs text-gray-500 truncate">Ready to play</p>
            </div>
        </div>
        <div class="flex flex-col items-center w-[40%]">
            <div class="flex items-center gap-6 mb-1 text-white">
                <button onclick="prevSong()" class="hover:text-purple-400"><i class="fas fa-backward-step text-xl"></i></button>
                <button onclick="togglePlay()" class="w-10 h-10 bg-white text-black rounded-full flex items-center justify-center hover:scale-105 transition"><i id="playIconMini" class="fas fa-play ml-0.5"></i></button>
                <button onclick="nextSong()" class="hover:text-purple-400"><i class="fas fa-forward-step text-xl"></i></button>
            </div>
            <div class="w-full h-1 bg-[#333] rounded-full relative cursor-pointer group" onclick="seekClick(event, this)">
                <div id="progressMini" class="absolute h-full bg-purple-500 rounded-full w-0 group-hover:bg-purple-400"></div>
            </div>
        </div>
        <div class="w-[30%] hidden md:flex justify-end items-center gap-2">
            <i class="fas fa-volume-high text-gray-400 text-xs"></i>
            <div class="w-20 h-1 bg-[#333] rounded-full"><div class="w-3/4 h-full bg-white"></div></div>
        </div>
    </div>

    <!-- FULLSCREEN -->
    <div id="fsOverlay" class="fs-overlay fixed inset-0 z-[200] bg-[#050505] flex flex-col p-6 overflow-y-auto">
        <div class="absolute inset-0 z-0 opacity-30"><img id="fsBg" class="w-full h-full object-cover blur-[80px]"></div>
        <div class="relative z-10 flex justify-between items-center mb-4 mt-2">
            <button onclick="closeFullscreen()" class="text-white w-10 h-10 rounded-full hover:bg-white/10 flex items-center justify-center"><i class="fas fa-chevron-down"></i></button>
            <span class="text-xs font-bold tracking-[0.2em] text-purple-300">SHANOVE</span>
            <button class="text-white w-10 h-10"><i class="fas fa-ellipsis-vertical"></i></button>
        </div>
        <div class="relative z-10 flex-1 flex flex-col items-center justify-center max-w-lg mx-auto w-full">
            <div class="w-full aspect-square rounded-xl shadow-[0_20px_50px_rgba(0,0,0,0.5)] mb-8 overflow-hidden border border-white/10 bg-[#222]">
                <img id="fsThumb" src="https://n.uguu.se/olrRLQVZ.jpg" class="w-full h-full object-cover">
            </div>
            <div class="w-full mb-6 px-2">
                <h1 id="fsTitle" class="text-2xl font-bold text-white truncate mb-1">No Song</h1>
                <p id="fsArtist" class="text-lg text-gray-400">Select song...</p>
            </div>
            <div class="w-full mb-6 px-2">
                <input type="range" id="fsSeek" value="0" max="100" class="w-full h-1 bg-gray-600 rounded-lg appearance-none accent-purple-500 cursor-pointer" oninput="seek(this.value)">
                <div class="flex justify-between w-full text-xs text-gray-300 mt-2"><span id="timeFs">0:00</span><span id="durFs">0:00</span></div>
            </div>
            <div class="flex items-center justify-between w-full px-4">
                <button class="text-gray-400"><i class="fas fa-shuffle text-xl"></i></button>
                <button onclick="prevSong()" class="text-white text-3xl"><i class="fas fa-backward-step"></i></button>
                <button onclick="togglePlay()" class="w-20 h-20 bg-white rounded-full text-black flex items-center justify-center text-3xl shadow-lg hover:scale-105 transition"><i id="playIconFs" class="fas fa-play ml-1"></i></button>
                <button onclick="nextSong()" class="text-white text-3xl"><i class="fas fa-forward-step"></i></button>
                <button class="text-gray-400"><i class="fas fa-repeat text-xl"></i></button>
            </div>
        </div>
    </div>

    <audio id="audioPlayer"></audio>

    <script>
        // --- KONFIGURASI API (WAJIB BENAR) ---
        const API_KEY = "RS-e5vtb61yow";
        const EMAILJS_KEY = "0eVdYs-0usPaFRNPf";
        const EMAILJS_SERVICE = "service_rlpso0c";
        const EMAILJS_TEMPLATE = "template_6ylv3rq";

        (function(){ emailjs.init(EMAILJS_KEY); })();

        // --- AUTH ---
        if(localStorage.getItem('shanove_user')) document.getElementById('loginOverlay').classList.add('hidden');

        function sendOTP() {
            const email = document.getElementById('emailInput').value;
            const btn = document.getElementById('btnSend');
            if(!email.includes('@')) return alert("Email salah!");
            
            const otp = Math.floor(100000 + Math.random() * 900000);
            btn.innerText = "Mengirim..."; btn.disabled = true;

            const params = { to_email: email, email: email, otp_code: otp };
            emailjs.send(EMAILJS_SERVICE, EMAILJS_TEMPLATE, params).then(() => {
                document.getElementById('emailForm').classList.add('hidden');
                document.getElementById('otpForm').classList.remove('hidden');
                document.getElementById('targetEmail').innerText = email;
                sessionStorage.setItem('otp', otp);
            }, (err) => {
                alert("Gagal kirim. Cek internet."); btn.innerText = "Masuk"; btn.disabled = false;
            });
        }

        function verifyOTP() {
            if(document.getElementById('otpInput').value == sessionStorage.getItem('otp')) {
                localStorage.setItem('shanove_user', 'true');
                document.getElementById('loginOverlay').classList.add('hidden');
            } else alert("OTP Salah!");
        }

        // --- ENGINE MUSIK FERDEV (FULL AUDIO) ---
        const audio = document.getElementById('audioPlayer');
        let queue = [];
        let curIndex = -1;
        let isPlaying = false;

        // 1. SEARCH: Cari list lagu (Belum ada gambar, cuma data text)
        async function searchMusic(query) {
            if(!query) return;
            
            const loader = document.getElementById('loading');
            const grid = document.getElementById('trackGrid');
            
            document.getElementById('homeSuggestions').classList.add('hidden');
            loader.classList.remove('hidden');
            grid.classList.add('hidden');
            document.getElementById('resultTitle').classList.remove('hidden');
            document.getElementById('resultTitle').innerText = `Mencari "${query}"...`;

            try {
                // Endpoint Search Ferdev
                const url = `https://api.ferdev.my.id/search/spotify?query=${encodeURIComponent(query)}&apikey=${API_KEY}`;
                const res = await fetch(url);
                const json = await res.json();

                if(json.result && json.result.length > 0) {
                    queue = json.result; // Simpan hasil search ke antrian
                    renderGrid();
                    document.getElementById('resultTitle').innerText = `Hasil: "${query}"`;
                } else {
                    document.getElementById('resultTitle').innerText = "Tidak ditemukan.";
                }
            } catch (e) {
                alert("Error API Search.");
            } finally {
                loader.classList.add('hidden');
                grid.classList.remove('hidden');
            }
        }

        // 2. RENDER GRID (Gambar Default Keren karena API Search gapunya gambar)
        function renderGrid() {
            const grid = document.getElementById('trackGrid');
            grid.innerHTML = queue.map((t, i) => `
                <div onclick="playMusic(${i})" class="bg-[#181818] p-4 rounded-xl hover:bg-[#252525] transition cursor-pointer group border border-transparent hover:border-[#333]">
                    <div class="relative mb-3 aspect-square rounded-lg shadow-lg overflow-hidden bg-gradient-to-br from-gray-800 to-black flex items-center justify-center border border-white/5">
                        <i class="fas fa-compact-disc text-6xl text-gray-600 group-hover:rotate-180 transition duration-700"></i>
                        <div class="absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 bg-black/50 transition">
                             <i class="fas fa-play text-white text-3xl"></i>
                        </div>
                    </div>
                    <h3 class="font-bold text-white text-sm truncate">${t.name}</h3>
                    <p class="text-gray-400 text-xs truncate">${t.artists}</p>
                </div>
            `).join('');
        }

        // 3. PLAY: Proses Download -> Dapet Link Asli & Gambar -> Play
        async function playMusic(index) {
            if(index < 0 || index >= queue.length) return;
            curIndex = index;
            const track = queue[index];

            // Tampilkan Loading Audio
            const audioLoader = document.getElementById('audioLoader');
            audioLoader.classList.remove('hidden');

            try {
                // Endpoint Downloader Ferdev
                const dlUrl = `https://api.ferdev.my.id/downloader/spotify?link=${track.url}&apikey=${API_KEY}`;
                console.log("Fetching:", dlUrl);
                
                const res = await fetch(dlUrl);
                const json = await res.json();

                if(json.success && json.download) {
                    // SUKSES DAPET DATA
                    const mp3 = json.download;
                    const img = json.data.thumbnail || "https://n.uguu.se/olrRLQVZ.jpg";
                    const title = json.data.title || track.name;
                    const artist = json.data.artist || track.artists;

                    // Update UI Player
                    updatePlayerUI(title, artist, img);
                    
                    // Play Audio
                    audio.src = mp3;
                    audio.play();
                    isPlaying = true;
                    updateIcons();
                } else {
                    alert("Gagal mengambil audio dari server.");
                }
            } catch (e) {
                console.error(e);
                alert("Gagal memproses lagu.");
            } finally {
                audioLoader.classList.add('hidden');
            }
        }

        function updatePlayerUI(title, artist, img) {
            document.getElementById('miniTitle').innerText = title;
            document.getElementById('miniArtist').innerText = artist;
            document.getElementById('miniThumb').src = img;
            
            document.getElementById('fsTitle').innerText = title;
            document.getElementById('fsArtist').innerText = artist;
            document.getElementById('fsThumb').src = img;
            document.getElementById('fsBg').src = img;
        }

        // CONTROLS
        function togglePlay() {
            if(!audio.src) return;
            if(audio.paused) { audio.play(); isPlaying = true; } 
            else { audio.pause(); isPlaying = false; }
            updateIcons();
        }

        function updateIcons() {
            const cls = isPlaying ? "fa-pause" : "fa-play";
            document.getElementById('playIconMini').className = `fas ${cls} ml-0.5`;
            document.getElementById('playIconFs').className = `fas ${cls} ml-1`;
        }

        function nextSong() { playMusic(curIndex + 1); }
        function prevSong() { playMusic(curIndex - 1); }

        audio.addEventListener('timeupdate', () => {
            if(!audio.duration) return;
            const pct = (audio.currentTime / audio.duration) * 100;
            document.getElementById('progressMini').style.width = pct + "%";
            document.getElementById('fsSeek').value = pct;
            
            const fmt = s => {
                if(isNaN(s)) return "0:00";
                const m = Math.floor(s/60), sec = Math.floor(s%60);
                return `${m}:${sec<10?'0':''}${sec}`;
            };
            document.getElementById('timeFs').innerText = fmt(audio.currentTime);
            document.getElementById('durFs').innerText = fmt(audio.duration);
        });
        audio.addEventListener('ended', nextSong);

        function seek(v) { if(audio.src) audio.currentTime = (v/100)*audio.duration; }
        function showHome() { document.getElementById('homeSuggestions').classList.remove('hidden'); document.getElementById('trackGrid').classList.add('hidden'); document.getElementById('resultTitle').classList.add('hidden'); }
        function openFullscreen() { if(audio.src) document.getElementById('fsOverlay').classList.add('active'); }
        function closeFullscreen() { document.getElementById('fsOverlay').classList.remove('active'); }
        function logout() { localStorage.removeItem('shanove_user'); location.reload(); }
        function resetLogin() { localStorage.removeItem('shanove_user'); location.reload(); }
        function seekClick(e, el) { if(!audio.src) return; const rect = el.getBoundingClientRect(); audio.currentTime = ((e.clientX - rect.left)/rect.width) * audio.duration; }
    </script>
</body>
</html>



